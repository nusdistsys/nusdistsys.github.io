<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Zookeeper | 6.824 DYOM</title><link rel=canonical href=https://nusdistsys.github.io/notes/zookeeper/><link rel=stylesheet href=https://nusdistsys.github.io/css/base.css integrity crossorigin=anonymous></head><body><nav><div class="px-2 bg-teal-700 fixed w-full"><ul class="flex h-full list-none m-0"><li class=p-4><a class="inline font-medium text-xl text-white" href=https://nusdistsys.github.io/>6.824 DYOM</a></li><li class="flex hover:bg-teal-800 h-full content-center p-4"><a class="inline font-light text-xl text-white" href=https://nusdistsys.github.io/labs/>Labs</a></li><li class="flex hover:bg-teal-800 h-full content-center p-4"><a class="inline font-light text-xl text-white" href=https://nusdistsys.github.io/notes/>Notes</a></li></ul></div></div></nav><main><div class="container max-w-3xl mx-auto pt-20"><article><header><span class="block py-8"><h1><a class=font-sans href=https://nusdistsys.github.io/notes/zookeeper/ rel=bookmark>Zookeeper</a></h1><time datetime=2020-02-13T16:04:06+08:00>13 February, 2020</time></span></header><h2 id=leader-elections>Leader Elections</h2><p>Leader is needed to order client requests into a transaction.</p><p>The leader elected is the node with the smallest <strong>zxid</strong>.</p><p>Each server starts in the LOOKING state, where it must either elect a new leader or find the existing one. If a leader already exists, other servers inform the new one which server is the leader. At this point, the new server connects to the leader and makes sure that its own state is consistent with the state of the leader.
If an ensemble of servers, however, are all in the LOOKING state, they must communicate to elect a leader. They exchange messages to converge on a common choice for the leader. The server that wins this election enters the LEADING state, while the other servers in the ensemble enter the FOLLOWING state.</p><p>The leader election messages are called leader election notifications, or simply notifica‐ tions. The protocol is extremely simple. When a server enters the LOOKING state, it sends a batch of notification messages, one to each of the other servers in the ensemble. The message contains its current vote, which consists of the server’s identifier (sid) and the zxid (zxid) of the most recent transaction it executed. Thus, (1,5) is a vote sent by the server with a sid of 1 and a most recent zxid of 5.</p><p>Server changes vote if it receives a vote that has a higher zxid and a higher server number (in that order)</p><h2 id=zab-zookeeper-atomic-broadcast-protcol>ZAB (Zookeeper atomic broadcast protcol)</h2><p>ZAB does a two phase commit</p><p><img src=https://user-images.githubusercontent.com/28092058/74420774-f159cd80-4e86-11ea-9db7-bc3d353d1a9f.png alt="two phase"></p><ol><li>The leader sends a PROPOSAL message, p, to all followers.</li><li>Upon receiving p, a follower responds to the leader with an ACK, informing the
leader that it has accepted the proposal.</li><li>Upon receiving acknowledgments from a quorum (the quorum includes the leader
itself ), the leader sends a message informing the followers to COMMIT it.</li></ol><p>ZAB Guarantees:</p><ol><li><p>Elected leader has committed all transactions that will ever be committed from previous epochs before it starts broadcasting new transactions.</p></li><li><p>At no point in time, two servers will have quorom.</p></li></ol><p>Note that it is possible to have a quorom to commit at the same time when a new leader has quorum</p><h2 id=zookeper-sessions>Zookeper sessions</h2><p>They have buckets (imagine a linkedlist, with random access).</p><p>They</p></article></div></main></body></html>